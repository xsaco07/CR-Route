{% extends "base.html" %}

{% block title %}
CR-Route
{% endblock title %}

{% block mainContent %}
<div class="container">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h1 class="text-center" style="padding: 25px;">Formulario Empresa</h1>
            {% if info_message %}
            <div class="alert alert-success" role="alert">
                {{info_message}}
            </div>
            {% endif %}
            <form method="POST" action="{{action}}">
                <!-- NOMBRE -->
                <div class="form-group">
                    <label for="nombre">Nombre</label>
                    <input value="{{nombre}}" name="nombre" type="text" class="form-control" required>
                </div>

                <!-- ZONA -->
                <div class="form-group">
                    <label for="zona">Zona</label>
                    <input value="{{zona}}" name="zona" type="text" class="form-control" aria-describedby="help-zona"
                        required>
                    <small id="help-zona" class="form-text text-muted">Lugares donde da servicio la empresa (sitio
                        origen y destino)</small>
                    <small id="help-zona" class="form-text text-muted">Ej: Alajuela - San José, Alajuela -
                        Heredia...</small>
                </div>

                <!-- TELEFONO -->
                <div class="form-group">
                    <label for="telefono">Teléfono</label>
                    <input value="{{telefono}}" name="telefono" type="number" class="form-control" required>
                </div>


                <!-- CORREO -->
                <div class="form-group">
                    <label for="correo">Correo electrónico</label>
                    <input value="{{correo}}" name="correo" type="email" class="form-control" required>
                </div>

                <!-- DIRECCION -->
                <div class="form-group">
                    <label for="direccion">Dirección física de su terminal</label>
                    <input value="{{direccion}}" name="direccion" type="text" class="form-control" required>
                    <small id="help-zona" class="form-text text-muted">Por señas</small>
                </div>

                <!-- MAPA -->
                <div id="map" style="width: 600px; height: 400px;">
                </div>

                <!-- LATITUD -->
                <div class="form-group">
                    <label for="lat">Latitud</label>
                    <input value="{{latitud}}" id="lat" name="latitud" type="number" step="any" class="form-control" required>
                </div>

                <!-- LONGITUD -->
                <div class="form-group">
                    <label for="lon">Longitud</label>
                    <input value="{{longitud}}" id="lon" name="longitud" type="number" step="any" class="form-control" required>
                </div>

                <!-- HORARIO -->
                <div class="form-group">
                    <label for="horario">Horario de atención al público</label>
                    <input value="{{horario}}" name="horario" type="text" class="form-control"
                        aria-describedby="help-horario" required>
                    <small id="help-horario" class="form-text text-muted">Ej: Lunes a Viernes, a partir de las 6:00am
                        luego cada 30 minutos hasta las 9:00pm.</small>
                </div>

                <!-- ENVIAR -->
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>

            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
                integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
                crossorigin="" />
            <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
                integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
                crossorigin=""></script>
            <script>
                var latInput = $("#lat");
                var lonInput = $("#lon");
                
                var initLocation = [51.505, -0.09];

                if(latInput.val() && lonInput.val()){
                    initLocation = [
                        parseFloat(latInput.val()),
                        parseFloat(lonInput.val()),
                    ]
                }
                
                var mymap = L.map('map').setView(initLocation, 13);
                var marker = L.marker(initLocation).addTo(mymap);

                L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                    maxZoom: 18,
                    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                        '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                        'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                    id: 'mapbox.streets'
                }).addTo(mymap);

                function onMapClick(e) {
                    marker.setLatLng(e.latlng);
                    latInput.val(e.latlng["lat"]);
                    lonInput.val(e.latlng["lng"]);
                }

                mymap.on('click', onMapClick);
            </script>

        </div>
    </div>
</div>


{% endblock mainContent %}